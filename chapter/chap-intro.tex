
\chapter{引言}
\label{chap:introduction}

随着计算机硬件技术的不断发展，以及用户应用需求的多样化，迫使应用提供商给出越来越多样化的解决方案，而这样会造成资源的浪费以及适应不同平台而造成的开销。虚拟化技术的诞生恰好是为了解决这些问题的，而且虚拟化技术正在受到越来越多的关注，包括国际著名的IT企业Citrix、VMware，Google、Microsoft、Amazon等互联网公司也不断在这个领域推陈出新；IBM、DELL等传统IT 厂商也被迫转型，不断调整公司的战略计划、商业模式；AT\&T、Verison等电信运营商作为传统的IDC和电信服务提供商业看到了机遇，一方面不断提升基础硬件，一方面不断拓展云计算虚拟化业务。可以预见，虚拟化技术将是继互联网之后，又一个给整个信息产业但来突破性发展的技术革新。

\section{研究背景}
虚拟化的概念最早由计算机科学家Christopher Strachey在一篇名为《Time Sharing in Large Fast Computers》\cite{Strachey} 的学术报告中提出。然后在20世纪60年代，为了共享昂贵的大型机资源，IBM公司发明了一种操作系统的虚拟机技术，并将该技术运用于VM/370系统中。而如今，硬件技术的飞速发展已经为虚拟化提供了更为有利的支持，它是构筑在互联网基础上的一系列技术，它将高速互联网、高性能计算机、大型数据库、移动终端设备等融为一体。而在虚拟化等基础上衍生出来的云计算，则更加让人们透明的使用计算资源、存储、数据等。

虚拟化所能提供的强大功能，必然在理论研究和应用实现上带来前所未有的挑战。虽然如此，在需求驱使的推动下，它在理论和实践中不断取得发展。包括中国在内，全世界很多国家都在对虚拟化、云计算投入巨大的人力财力，也产生了很多具有里程碑意义的研究结果。

互联网公司由于自身业务需求构建了基于分布式技术的可支撑海量数据信息处理和存储的统一IT基础设施；IT厂商考虑的则是如何保护企业已有的IT投资，主推虚拟化技术作为IT资源的整合手段，以帮助企业更平滑地过渡到云计算。不过，不论是分布式技术还是虚拟化技术，都只是云计算实现的基本技术手段，真正使云计算“落地”的核心技术还是如何实现虚拟化资源和分布式集群规模化及统一管理，以形成具备良好的弹性和可扩展性的资源池（计算和存储云），同时将应用基于互联网交付给用户（交付云）。这就像程控交换技术和软交换技术，它们都是实现电话业务的技术，在设备技术成熟后，更重要的是要通过部署和组网形成一张规模较大的交换网，并实现全网统一管理和运营，才能真正提供优质的语音业务\cite{CloudCompCodec}。因此，在虚拟化、分布式技术基本成熟的环境下，虚拟计算平台资源调度系统以及其核心―资源分配问题无疑是最重要，最具挑战性的研究方向之一。

目前，云计算是网络计算的最新形态，是网格计算、并行计算、分布式计算的发展结果，同时也是一种崭新的商业模式，备受业界关注，尤其是IaaS\cite{CloudCompCodec}（Infrastructure as a Service，即基础设施即服务）把业务部署在由大量服务器、存储设备、网络设备构建的资源池上。由于用户提交的请求有多个，并且需求不一，因此需要对有限的资源进行合理分配，才能满足应用的需求，同时达到节约资源的目的，这也是设计资源调度系统的初衷与目的。

\section{研究目的及意义}
云计算使计算分布在大量的分布式计算机上，对于用户来说，并不关心这些隐藏在“云”后面的架构，它就像一朵云一样。这样，企业就能将资源切换到需要的应用上，根据需求访问计算机和存储系统，而无需关心这些繁琐的资源管理，大大降低了企业信息化的复杂度。

在云计算平台中，资源以服务的形式按需分配，并且要保证用户满足服务等级协议（Service Level Agreement，简称SLA）。然而，由于资源是共享的，并且用户的需求有着动态的不均衡和平台差异，如果不能合理的分配这些有限的资源，势必会造成资源的浪费。除此之外，云计算平台同样需要满足动态负载平衡，以避免任务的频繁迁移带来的开销的同时尽可能高的提高资源的利用率。因此，从宏观上讲，如何管理资源以最大化的满足用户的需求成了一个有待解决的问题。

虚拟化技术最早是为了大型机系统提供虚拟化而服务的。随着信息技术的发展，虚拟化再次成为提高硬件利用率，整合企业计算资源的重要解决方案。它提供了一个高效的解决方案来管理云计算平台上的资源。从提交服务到虚拟机，映射到每个物理主机，再从解决平台和用户需求的不均衡到满足SLA，虚拟化技术都很好的给出了解决方案。此外，虚拟化技术还能够依据不同虚拟机（VM）和物理资源之间的关系改变这种映射，力求在整个系统内达到一种负载均衡。因此，虚拟化技术越来越多的使用在了云计算之中。但是，正是由于平台上资源的及不均衡，虚拟机必须动态地适应这些问题，以获得更好的性能。所以，如何提高虚拟资源利用率是本文的研究重点。

在资源分配算法的研究过程中，产生了一些优秀的经典资源分配算法，如贪心（Greedy）、遗传（Genetic）、松弛线性规划（Relaxed LP）、装填算法（Vector Packing）\cite{intro_algorithm}。但是这些算法也存在不足之处，并且大部分是针对CPU计算资源的最大化满足，本文由于设计的是一个系统，所以将不同的算法实现为不同的模块，根据预测机制自动调用不同的模块，实现资源的最大化利用，并在时空上达到最优。


\section{国内外研究现状}
本节就算法策略模块介绍国内外研究的现状，虚拟资源分配策略的研究一直是一个热点问题，尤其是近年来的一些发展。

文献\cite{intro_SJSU}中，圣何塞州立大学的项目提出了一种遗传算法，利用生物遗传理论，结合当前的计算机学科。由于考虑了历史信息，并结合当前的状态，可以提前计算部署后可能产生的影响，挑选一个影响最小的分配方案，以达到保证负载平衡的同时提高利用率，但是遗传算法有着致命的缺点，便是速度慢，有时也会有无解的情况产生。

在\cite{intro_probabilistic}中，研究员提出了基于概率分析的装填算法，从概率论角度研究了该模型。概率模型既具有描述性质，也具有预测性质。

在\cite{intro_probabilistic_theta}中，美国劳伦斯国家实验室的研究者提出了一种原地进行的$\Theta$(n)的二维装填算法，此算法考虑两个方面，即文件的负载和大小。并对此算法进行了严格的数学证明以及给出了算法执行的伪代码部分。

在Xen发展的过程中，曾经出现了SEDF、BVT和Credit算法。SEDF简单的基于截止时间进行调度，该算法是一种动态优先级调整的算法，VCPU的优先级随着其绝对截止时间的变化而变化。但是SEDF算法在负载重的情况下表现出很多的时间错误，也不能对CPU以外的资源进行操作。BVT算法是一种公平性优先的调度算法，它将时间分为虚拟时间和实际时间，运行的时候用虚拟时间监控进程的执行时间，在一定的范围内，允许操作可以“借”未来的时间先过来运行。BVT算法优点在于可以公平均匀地将物理时间分配给各个虚拟机，满足I/O密集和低延迟的要求。但是BVT不支持NWC（non-working-conservation）模式，即每次运行时获得整个CPU；每个虚拟机只能借用自己的时间片，而不会剥夺其它虚拟机的时间片。Credit算法是Xen 3.0以来的默认调度算法，它是一种按比例公平共享的非抢占式调度算法，它可以全局管理多个物理CPU，从而将CPU公平高效地分配给各个虚拟CPU，它也可以很好的支持NWC模式。但是Credit算法的缺点是不能保证实时性，在I/O等对时延比较敏感的应用中，影响尤为重要。

之前的研究基本上都是局限于尽可能高的提高资源的利用率方面，而\cite{intro_DRF}中的DRF算法是MESOS平台上的调度策略，该算法是一种基于经济学博弈理论的公平分配策略，并在Facebook实际测试了2个月获得了预期的效果。该策略不同于以往满足某些资源的高需求的策略，它能刺激用户共享他们的资源（Sharing Incentive，即共享刺激），保证自己所获得的资源永远都是自我满足的（Envy-freeness性质）。该策略也是具有防策略（Strategy-proofness）性质的，即不能通过欺骗获得更多的资源。最后，DRF 满足帕累托最优（Pareto-efficiency）原则。该算法一经发表，就获得了state of the art 的称赞，并吸引了很多研究者的兴趣。但是此方法的初期版本也有缺陷，不能获得很高的资源利用率，甚至有时利用率不及FIFO的性能。

在DRF算法发布不久，第32届分布式计算系统国际会议（The 32nd International Conference on Distributed Computing Systems）上的一篇论文《Multi-dimensional Resource Integrated Scheduling In a Shared Data Center》\cite{intro_BMDKP}提出了之前的算法仅考虑单资源的情况，却忽略了资源是有比例关系的，考虑了资源之间的依赖关系，提出了全新的启发式算法，并通过仿真验证了性能和效率的正确性，同时比较了DRF 算法，指出了DRF的缺陷。

此外，还有很多开源的云系统供研究者作为平台开发自己的云计算项目。比如Eucalyptus\cite{intro_EUCAL}，Open Nebula\cite{intro_nebula}，Open Stack\cite{intro_openstack}等等。Eucalyptus使用贪心和循环算法，Open Nebula 使用队列、高级保留以及预取技术，而Open Stack中使用的是Chance Scheduler，即随机算法。开源平台的好处就是研究者可以根据自己的需要替换默认的调度策略。

作为虚拟化技术的领导厂商，VMware\cite{VMware}在虚拟化方面有着雄厚的技术，VMware 分布式资源调度程序（Distributed Resource Scheduler，简称DRS）跨聚合到逻辑资源池中的硬件资源集合来动态地分配和平衡计算容量。

\begin{itemize}
  \item 使资源优先于最重要的应用程序，以便让资源与业务目标相协调
  \item 自动、不间断地优化硬件利用率，以响应不断变化的情况
  \item 为业务部门提供专用的（虚拟）基础结构，同时让IT部门能够集中、全面地控制硬件
  \item 执行零停机服务器维护。
\end{itemize}

VMware DRS跨资源池不间断地监控利用率，并在多个虚拟机之间智能地分配可用资源。VMware DRS允许用户确定以下方面的规则和策略：决定虚拟机共享资源的方式与在多个虚拟机之间排定这些资源的优先级的方式。当虚拟机遇到负载增大时，VMware DRS将首先根据既定的资源分配规则和策略评估其优先级，如果合理，则分配更多资源。资源是通过以下两种方式分配给虚拟机的：将虚拟机迁移到具有更多可用资源的另一台服务器上；或者通过将其他虚拟机迁移到别的服务器上而在此服务器上为该虚拟机营造更大的“空间”。通过VMware VMtion将虚拟机实时迁移到不同的物理服务器是以对最终用户完全透明的方式完成的。

实际上，现有的研究不仅仅是上面所罗列的，国内外的研究者都在这个领域贡献着自己的智慧，提出更加高效的算法，开发更加有效的系统。
\section{研究内容与组织框架}
\subsection{研究内容}
总结毕设期间的研究，主要集中于以下几个方面：
\begin{enumerate}
  \item 研究了虚拟化技术，分布式集群计算，借助Xen架构，分析了其中的原理与机制
  \item 研究了虚拟资源调度系统的具体设计实现以及具体的应用
  \item 通过阅读大量论文，研究了各种资源分配算法，分析了各个算法的适应场景以及优缺点
  \item 通过测试，评估了本文提出的系统具的可行性和合理性
\end{enumerate}
\subsection{组织框架}
本文的组织如下：

第一章为引言部分，是全文的铺垫部分，介绍了本文研究的背景、目的以及研究的意义所在，并分析了国内外此领域的研究现状

第二章首先介绍了本文研究背景中的虚拟化技术的发展，在第二节中对虚拟资源调度系统的发展和分类做了介绍和分析，然后介绍和分析了虚拟资源调度系统中的关键技术。

第三章提出了虚拟资源调度系统的架构设计，并对该系统进行了理论上的分析。

第四章通过测试验证了该系统，并对核心的调度算法进行了可行性与正确性的验证，总结了具体的应用环境。

第五章是本论文的结束语部分，对全文做一总结，同时针对设计的系统提出了一些改进的愿望，并对下一步要进行的工作做了简要的介绍。

